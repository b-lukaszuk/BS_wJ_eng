<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Bartlomiej Lukaszuk" />
  <title>Solution - Build SH*T with Julia</title>
  <link rel="stylesheet" href="./style.css"/>
    <script src="./mousetrap.min.js"></script>
    <style>
  @font-face {
    font-family: JuliaMono-Regular;
    src: url("./JuliaMono-Regular.woff2");
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <link rel="stylesheet" href="./github.min.css">
<script src="./highlight.min.js"></script>
<script src="./julia.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre').forEach((el) => {
        if (!el.classList.contains('output')) {
            hljs.highlightElement(el);
        }
    });
});
</script>
 
</head>
<body>
<script>
function click_next() {
  var next = document.getElementById('nav-next');
  next.firstElementChild.nextElementSibling.click();
}
function click_prev() {
  var prev = document.getElementById('nav-prev');
  prev.firstElementChild.click();
}
Mousetrap.bind('right', click_next);
Mousetrap.bind('h', click_prev);
Mousetrap.bind('left', click_prev);
Mousetrap.bind('l', click_next);
</script>

<div class="books-container">
<aside class="books-menu">
<input type="checkbox" id="menu">
<label for="menu">☰</label>
<div class="books-title">
<a href="./">Build SH*T with Julia</a>
</div><br />
<span class="books-subtitle">

</span>
<div class="books-menu-content">
<li><a class="menu-level-1" href="./about.html"><b>1</b> About</a></li>
<li><a class="menu-level-1" href="./mat_multip.html"><b>2</b> Matrix Multiplication</a></li>
<li><a class="menu-level-2" href="./mat_multip_problem.html"><b>2.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./mat_multip_solution.html"><b>2.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./bat_and_ball.html"><b>3</b> Bat and Ball</a></li>
<li><a class="menu-level-2" href="./bat_and_ball_problem.html"><b>3.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./bat_and_ball_solution.html"><b>3.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./camel_case.html"><b>4</b> Camel case</a></li>
<li><a class="menu-level-2" href="./camel_case_problem.html"><b>4.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./camel_case_solution.html"><b>4.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./toothpaste.html"><b>5</b> Toothpaste</a></li>
<li><a class="menu-level-2" href="./toothpaste_problem.html"><b>5.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./toothpaste_solution.html"><b>5.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./bile.html"><b>6</b> Bile</a></li>
<li><a class="menu-level-2" href="./bile_problem.html"><b>6.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./bile_solution.html"><b>6.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./recursion.html"><b>7</b> Recursion</a></li>
<li><a class="menu-level-2" href="./recursion_problem.html"><b>7.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./recursion_solution.html"><b>7.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./progress_bar.html"><b>8</b> Progress Bar</a></li>
<li><a class="menu-level-2" href="./progress_bar_problem.html"><b>8.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./progress_bar_solution.html"><b>8.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./pascals_triangle.html"><b>9</b> Pascal’s triangle</a></li>
<li><a class="menu-level-2" href="./pascals_triangle_problem.html"><b>9.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./pascals_triangle_solution.html"><b>9.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./leap_year.html"><b>10</b> Leap year</a></li>
<li><a class="menu-level-2" href="./leap_year_problem.html"><b>10.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./leap_year_solution.html"><b>10.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./calendar.html"><b>11</b> Calendar</a></li>
<li><a class="menu-level-2" href="./calendar_problem.html"><b>11.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./calendar_solution.html"><b>11.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./prime_numbers.html"><b>12</b> Prime Numbers</a></li>
<li><a class="menu-level-2" href="./prime_numbers_problem.html"><b>12.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./prime_numbers_solution.html"><b>12.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./compound_interest.html"><b>13</b> Compound interest</a></li>
<li><a class="menu-level-2" href="./compound_interest_problem.html"><b>13.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./compound_interest_solution.html"><b>13.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./mortgage.html"><b>14</b> Mortgage</a></li>
<li><a class="menu-level-2" href="./mortgage_problem.html"><b>14.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./mortgage_solution.html"><b>14.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./overpayment.html"><b>15</b> Overpayment</a></li>
<li><a class="menu-level-2" href="./overpayment_problem.html"><b>15.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./overpayment_solution.html"><b>15.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./logo.html"><b>16</b> Logo</a></li>
<li><a class="menu-level-2" href="./logo_problem.html"><b>16.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./logo_solution.html"><b>16.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./transcription.html"><b>17</b> Transcription</a></li>
<li><a class="menu-level-2" href="./transcription_problem.html"><b>17.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./transcription_solution.html"><b>17.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./translation.html"><b>18</b> Translation</a></li>
<li><a class="menu-level-2" href="./translation_problem.html"><b>18.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./translation_solution.html"><b>18.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./stem_and_leaf.html"><b>19</b> Stem and Leaf Plot</a></li>
<li><a class="menu-level-2" href="./stem_and_leaf_problem.html"><b>19.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./stem_and_leaf_solution.html"><b>19.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./altruism.html"><b>20</b> Altruism</a></li>
<li><a class="menu-level-2" href="./altruism_problem.html"><b>20.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./altruism_solution.html"><b>20.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./shift.html"><b>21</b> Shift</a></li>
<li><a class="menu-level-2" href="./shift_problem.html"><b>21.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./shift_solution.html"><b>21.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./caesar.html"><b>22</b> Caesar</a></li>
<li><a class="menu-level-2" href="./caesar_problem.html"><b>22.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./caesar_solution.html"><b>22.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./vigenere.html"><b>23</b> Vigenere</a></li>
<li><a class="menu-level-2" href="./vigenere_problem.html"><b>23.1</b> Problem</a></li>
<li><a class="menu-level-2" href="./vigenere_solution.html"><b>23.2</b> Solution</a></li>
<li><a class="menu-level-1" href="./the-end.html"><b>24</b> The end</a></li>
</div>
</aside>

<div class="books-content">
<h2 data-number="22.2" id="sec:caesar_solution"><span class="header-section-number">22.2</span> Solution</h2>
<p>Let’s start by writing a function that will create alphabets for the outer and inner rings of the discs from Figure <a href="#fig:codingDiscs2">13</a>.</p>
<figure id="fig:codingDiscs2">
<img src="./images/codingDiscs.png" alt="Figure 13: Coding Discs. The outer disc contains the original alphabet. The inner disc contains the alphabet shifted by 2 characters" />
<figcaption aria-hidden="true">Figure 13: Coding Discs. The outer disc contains the original alphabet. The inner disc contains the alphabet shifted by 2 characters</figcaption>
</figure>
<pre class="language-julia"><code>function getAlphabets(rotBy::Int, upper::Bool)::Tuple{Str, Str}
    alphabet::Str = upper ? join(&#39;A&#39;:&#39;Z&#39;) : join(&#39;a&#39;:&#39;z&#39;)
    rot::Int = abs(rotBy) % length(alphabet)
    rotAlphabet::Str = alphabet[(rot+1):end] * alphabet[1:rot]
    return rotBy &lt; 0 ? (rotAlphabet, alphabet) : (alphabet, rotAlphabet)
end</code></pre>
<p>First we create an alphabet made of <code>'a'</code> to <code>'z'</code> letters with the desired casing (<code>upper</code>) using a <a href="https://docs.julialang.org/en/v1/base/collections/#Base.StepRange">StepRange</a> (<code>'a':'z'</code> or <code>'A':'Z'</code>) that we <code>join</code> into a string. Next, we use <a href="https://docs.julialang.org/en/v1/base/math/#Base.rem">modulo operator</a> (<code>%</code> - returns reminder of a division) to get the desired rotation (<code>rot</code>). This allows us to gracefully handle the overflow of <code>rotBy</code> [e.g. when <code>rotBy</code> is 28 and <code>length(alphabet)</code> is 26 we get <code>28 % 26</code>i.e. <code>2</code> (full circle turn + shift by 2 fields)]. Then we create the rotated alphabet (<code>rotAlphabet</code>) starting at <code>(rot+1)</code> and appending (<code>*</code>) the beginning of the normal <code>alphabet</code>. Finally, if <code>rotBy</code> is negative (<code>rotBy &lt; 0</code>, decrypting the message) we return <code>rotAlphabet</code> and <code>alphabet</code> to be used as outer and inner disc in Figure <a href="#fig:codingDiscs2">13</a>, respectively. Otherwise <code>alphabet</code> lands in the outer ring and ‘rotAlphabet’ in the inner one.</p>
<p>Time for a simple test.</p>
<pre class="language-julia"><code>Dict(i =&gt; getAlphabets(i, true) for i in -1:1:1)</code></pre>
<pre class="output"><code>Dict{Int64, Tuple{String, String}} with 3 entries:
  0 =&gt; (&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;, &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;)
  -1 =&gt; (&quot;BCDEFGHIJKLMNOPQRSTUVWXYZA&quot;, &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;)
  1 =&gt; (&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;, &quot;BCDEFGHIJKLMNOPQRSTUVWXYZA&quot;)</code></pre>
<p>Appears to be working as intended. Now, even a greatest journey begins with a first step. Therefore, in order to encode any text we need to be able to encode a single character.</p>
<pre class="language-julia"><code>function codeChar(c::Char, rotBy::Int)::Char
    outerDisc::Str, innerDisc::Str = getAlphabets(rotBy, isuppercase(c))
    ind::Union{Int, Nothing} = findfirst(c, outerDisc)
    return isnothing(ind) ? c : innerDisc[ind]
end</code></pre>
<pre class="output"><code>codeChar (generic function with 1 method)</code></pre>
<p>We begin by obtaining <code>outerDisc</code> and <code>innerDisc</code> with <code>getAlphabets</code> that we just created. Next, we search for the index (<code>ind</code>) of the character to encode (<code>c</code>) in the <code>outerDisc</code>. The search may fail (e.g. no <code>,</code> in an alphabet) so <code>ind</code> can be either <code>nothing</code> (value <code>nothing</code> of type <code>Nothing</code> indicates a failure) or an integer hence the type of <code>ind</code> is <code>Union{Int, Nothing}</code> to depict just that. Finally, if the search failed (<code>isnothing(ind)</code>) we just return <code>c</code> as it was, otherwise we return the encoded letter read from the inner ring (<code>innerDisc[ind]</code>). Observe.</p>
<pre class="language-julia"><code>(
    codeChar(&#39;a&#39;, 1),
    codeChar(&#39;A&#39;, 2),
    codeChar(&#39;,&#39;, 2)
)</code></pre>
<pre class="output"><code>(&#39;b&#39;, &#39;C&#39;, &#39;,&#39;)</code></pre>
<p>Once we know how to code a character, time to code a string.</p>
<pre class="language-julia"><code># rotBy &gt; 0 - encrypting, rotBy &lt; 0 - decrypting, rotBy = 0 - same msg
function codeMsg(msg::Str, rotBy::Int)::Str
    coderFn(c::Char)::Char = codeChar(c, rotBy)
    return map(coderFn, msg)
end</code></pre>
<p>And voila. Notice, that first we created <code>coderFn</code>, which is a function (<a href="https://en.wikibooks.org/wiki/Introducing_Julia/Functions#Single_expression_functions">single expression function</a>) inside of a function (<code>codeMsg</code>). Now we can neatly use it with <code>map</code>.</p>
<p>OK, time to decipher our enigmatic message (remember that in Section <a href="./shift_solution.html#sec:shift_solution">21.2</a> we figured out that the shift is equal 13).</p>
<pre class="language-julia"><code># be sure to adjust the path
# the file&#39;s size is roughly 31 KiB
codedTxt = open(&quot;./code_snippets/shift/trarfvf.txt&quot;) do file
    read(file, Str)
end

decodedTxt = codeMsg(codedTxt, -13)
&quot;&lt;&lt;&quot; * first(decodedTxt, 54) * &quot;&gt;&gt;&quot;</code></pre>
<p>&lt;&lt;In the beginning God created the heaven and the earth.&gt;&gt;</p>
<p>Hmm, it looks suspiciously like the first phrase from the Bible.</p>
<pre class="language-julia"><code>codeMsg(&quot;trarfvf&quot;, -13)</code></pre>
<p>genesis</p>
<p>And indeed, even the file name indicates that it is (a part of) the Book of Genesis.</p>
<p>We could stop here or try to improve our solution a bit.</p>
<p>Let’s try to define <code>getEncryptionMap</code> that will be an equivalent of our <code>getAlphabets</code>.</p>
<pre class="language-julia"><code>function getEncryptionMap(rotBy::Int)::Dict{Char, Char}
    encryptionMap::Dict{Char, Char} = Dict()
    alphabet::Str = join(&#39;a&#39;:&#39;z&#39;)
    rot::Int = abs(rotBy) % length(alphabet)
    rotAlphabet::Str = alphabet[(rot+1):end] * alphabet[1:rot]
    if rotBy &lt; 0
        alphabet, rotAlphabet = rotAlphabet, alphabet
    end
    for i in eachindex(alphabet)
        encryptionMap[alphabet[i]] = rotAlphabet[i]
        encryptionMap[uppercase(alphabet[i])] = uppercase(rotAlphabet[i])
    end
    return encryptionMap
end</code></pre>
<p>The function is pretty similar to the one previously mentioned, except for the fact that it returns a dictionary with the alphabet on the outer disc being the keys and the letters on the inner disc are its values (compare with Figure <a href="#fig:codingDiscs2">13</a>). Moreover, the map contains both lower- and upper-case characters.</p>
<p>Time to code a character.</p>
<pre class="language-julia"><code>function code(c::Char, encryptionMap::Dict{Char, Char})::Char
    return get(encryptionMap, c, c)
end</code></pre>
<p>To that end we used the built in <code>get</code> function that looks for a character (<code>c</code>, <code>get</code>’s second argument) in <code>encryptionMap</code>, if the search failed it returns the character as a default value (<code>c</code>, <code>get</code>’s third argument).</p>
<p>Finally, let’s code the message.</p>
<pre class="language-julia"><code>function code(msg::Str, rotBy::Int)::Str
    encryptionMap::Dict{Char, Char} = getEncryptionMap(rotBy)
    coderFn(c::Char)::Char = code(c, encryptionMap)
    return map(coderFn, msg)
end</code></pre>
<pre class="output"><code>code (generic function with 2 methods)</code></pre>
<p>Notice, that we defined two different versions (aka methods) of <code>code</code> function. Julia will choose the right one during the invocation based on the type of the arguments.</p>
<p>Time for a test.</p>
<pre class="language-julia"><code>codeMsg(codedTxt, -13) == code(codedTxt, -13)</code></pre>
<p>true</p>
<p>Works the same, still in the above case <code>codeMsg(codedTxt, -13)</code> takes tens of milliseconds to execute, whereas <code>code(codedTxt, -13)</code> only hundreds of microseconds (on my laptop). The human may not tell the difference, but we obtained some 50x speedup thanks to the faster lookups in dictionaries (sometimes called hash maps in other programming languages) and the fact that we do not generate our discs anew for every letter we code.</p>


<div class="bottom-nav">
    <p id="nav-prev" style="text-align: left;">
        <a class="menu-level-2" href="./caesar_problem.html"><b>22.1</b> Problem</a> <kbd>←</kbd>
        <span id="nav-next" style="float: right;">
            <kbd>→</kbd> <a class="menu-level-1" href="./vigenere.html"><b>23</b> Vigenere</a>
        </span>
    </p>
</div>


<div class="license">
    <br/>
  <br/>
  <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    Bartlomiej Lukaszuk
</div>
</div>
</div>
</body>
</html>